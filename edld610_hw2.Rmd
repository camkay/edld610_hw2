---
title: "EDLD 610: Homework 2"
author: "Cameron Kay, Lea Frank, Ashley Miller"
date: "2/18/2019"
output:
  html_document:
    theme: spacelab
    toc: yes
    toc_depth: 4
    toc_float: yes
editor_options: 
  chunk_output_type: console
---

```{r setup, include = FALSE}
# load packages
library(tidyverse)
library(magrittr)
library(lubridate)
library(rio)
library(here)
library(bit64)
#devtools::install_github("wilkelab/ungeviz")
library(ungeviz)
library(colorspace)
library(broom)

# load data
crime_data <- import(here("data/crime.csv"), setclass = "tibble") %>%
  janitor::clean_names() %>%
  mutate(first_occurrence_date = mdy_hms(first_occurrence_date),
         last_occurrence_date  = mdy_hms(last_occurrence_date),
         reported_date         = mdy_hms(reported_date))
```

### Part 1

Select rows corresponding to a crime and reproduce the following plot. Note that because these are proportion data, I used the following formula to calculate the standard error $\sqrt{(p(1âˆ’p)/n}$.

```{r part1_ash, fig.height=6, fig.width=6}

ash_prop_data <- crime_data %>%
  mutate(offense_category_id = stringr::str_to_title(offense_category_id))

ash_prop_data %<>%
    mutate(offense_category_id = recode(offense_category_id, 
                                      "Aggravated-Assault" = "Aggravated Assault",
                                      "All-Other-Crimes" = "All Other Crimes",
                                      "Auto-Theft" = "Auto Theft",
                                      "Drug-Alcohol" = "Drug Alcohol",
                                      "Other-Crimes-Against-Persons" = "Other Crimes Against Persons",
                                      "Public-Disorder" = "Public Disorder",
                                      "Sexual-Assault" = "Sexual Assault",
                                      "Theft-From-Motor-Vehicle" = "Theft From Motor Vehicle",
                                      "Traffic-Accident" = "Traffic Accident",
                                      "White-Collar-Crime" = "White Collar Crime")) %>%
  filter(offense_category_id != "Traffic Accident") %>%
  select(-incident_id:-offense_type_id,
         -first_occurrence_date,
         -last_occurrence_date,
         -incident_address:-geo_lat) %>%
  filter(is_crime == '1')

ash_prop_data %<>%
  count(offense_category_id) %>%
  mutate(prop = n/sum(n), 
         prop_se = sqrt((prop*(1-prop)) / n))

#str(props)
  
#Reproduce graph
ggplot(ash_prop_data, aes(fct_reorder(offense_category_id, prop), prop)) +
  geom_errorbar(aes(ymin = prop + qnorm(0.025)*prop_se, 
                    ymax = prop + qnorm(0.975)*prop_se),
                    color = "grey30",
                    width = 0.4, 
                    size = 0.4) +
  geom_point(color = "#17C9CF", alpha = 0.8, size = 2) +
  theme_minimal() +
  theme(axis.title = element_text(face = "bold"),
        strip.text = element_text(face = "bold"),
        plot.title = element_text(face = "bold")) +
  labs(title = "Crimes in Denver",
         x = "",
         y = "Percentage",
         caption = "Denver Crime Data Distributed via Kaggle
https://www.kaggle.com/paultimothymooney/denver-crime-data") +
  scale_y_continuous(breaks = c(0.0, 0.1, 0.2, 0.3),
                     label = c("0.0%", "10.0%", "20.0%", "30.0%"),
                     limits = c(-0.005, 0.3)) +
  coord_flip()

```

### Part 2

Visualize the same relation, but displaying the uncertainty using an alternative method of your choosing.

```{r part2_ash1}

ggplot(ash_prop_data, aes(prop, fct_reorder(offense_category_id, prop))) +
  stat_confidence_density(aes(moe = prop_se),
                          fill = "#17C9CF",
                          height = 0.6) +
  geom_point(alpha = 0.7) +
  theme_minimal() +
  theme(axis.title = element_text(face = "bold"),
        strip.text = element_text(face = "bold"),
        plot.title = element_text(face = "bold")) +
  labs(title = "Crimes in Denver",
         x = "",
         y = "Percentage",
         caption = "Denver Crime Data Distributed via Kaggle
https://www.kaggle.com/paultimothymooney/denver-crime-data") +
  scale_x_continuous(breaks = c(0.0, 0.05, 0.1, 0.15, 0.2, 0.25),
                     label = c("0.0%", "5.0%", "10.0%", "15.0%", "20.0%", "25.0%"),
                     limits = c(-0.005, 0.25))

```

### Part 3

Reproduce the following plot. Use the reported_date to extract the year.

```{r part3_cam}
# reproduce the plot
crime_data %>%
  mutate(year = year(reported_date),
         is_crime = as.logical(is_crime)) %>%
  group_by(year, district_id) %>%
  summarize(crime_count = n()) %>%
  mutate(prop = crime_count / sum(crime_count),
         prop_se = sqrt((prop * (1 - prop)) / crime_count),
         district_id = factor(district_id),
         c_int_low = (prop + (prop_se * qnorm(.025))),
         c_int_low = if_else(c_int_low < 0, 0, c_int_low),
         c_int_high = (prop + (prop_se * qnorm(.975)))) %>%
  ggplot(aes(x = reorder(district_id, prop), y = prop)) +
    geom_col(aes(fill = district_id)) +
    geom_errorbar(aes(ymin = c_int_low, ymax = c_int_high), color = "gray40", width = .5) +
    facet_wrap(~year) +
    coord_flip() +
    scale_fill_manual(values = c("#0072B2", "#F0E442", "#CC79A7", "#009E73", "#56B4E9", "#D55E00", "#E69F00")) +
    scale_y_continuous(breaks = c(0.0, 0.1, 0.2), limits = c(0, 0.255)) +
    labs(title = "Crimes in Denver",
         x = "District",
         y = "Proportion",
         caption = "Denver Crime Data Distributed by Kaggle \n https://www.kaggle.com/paultimothymooney/denver-crime-data") +
    theme_minimal() +
    theme(legend.position = "none",
          axis.title = element_text(size = 16),
          plot.title = element_text(size = 20),
          plot.caption = element_text(size = 14),
          axis.text = element_text(size = 14),
          strip.text.x = element_text(size = 14))

```

### Part 4

See assignment.

```{r part4_lea}

```

### Part 5

Reproduce the following table.

```{r part5_cam}

```